<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
</head>
<style>
    /* Container Styles */
    .catalogContainer, .requestContainer, .issuedContainer {
        margin: 20px;
        font-family: Arial, sans-serif;
        background-color: #f9f9f9; /* Uniform light grey background */
        padding: 10px;
        border-radius: 5px; /* Rounded corners */
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow */
    }

    /* Table Styles */
    .catalogTable, .requestTable, .issuedTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px; /* Space above the table */
    }

    .catalogTable th, .catalogTable td, 
    .requestTable th, .requestTable td, 
    .issuedTable th, .issuedTable td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    /* Table Headers */
    .catalogTable th, .requestTable th, .issuedTable th {
        background-color: #4CAF50; /* Uniform green background */
        color: white;
    }

    /* Zebra Striping for Rows */
    .catalogTable tr:nth-child(even), 
    .requestTable tr:nth-child(even), 
    .issuedTable tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    .catalogTable tr:hover, .requestTable tr:hover, .issuedTable tr:hover {
        background-color: #ddd; /* Light grey background on row hover */
    }

    /* Button and Link Styles */
    .editLink, .issuedTable button, .allocateForm button {
        color: white;
        background-color: #4CAF50; /* Uniform green background */
        padding: 5px 10px;
        text-decoration: none;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }

    .editLink:hover, .issuedTable button:hover, .allocateForm button:hover {
        background-color: #45a049; /* Darker green on hover */
    }

    .allocateForm input[type="date"] {
        padding: 5px;
        margin-right: 10px;
    }

    /* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
</style>
<body>

    <div class="catalogContainer">
        <h1>Catalog of Books</h1>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addBookModal">
            Add Book
        </button>
        <table class="catalogTable">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Genre</th>
                <th>Stock</th>
                <th>Edit</th>
            </tr>
            <!-- Dynamically generated rows will go here -->
        </table>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="addBookModal" tabindex="-1" role="dialog" aria-labelledby="addBookModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addBookModalLabel">Add New Book</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addBookForm">
                        <div class="form-group">
                            <label for="bookTitle">Title</label>
                            <input type="text" class="form-control" id="bookTitle" placeholder="Enter book title">
                        </div>
                        <div class="form-group">
                            <label for="bookAuthor">Author</label>
                            <input type="text" class="form-control" id="bookAuthor" placeholder="Enter author's name">
                        </div>
                        <div class="form-group">
                            <label for="bookGenre">Genre</label>
                            <input type="text" class="form-control" id="bookGenre" placeholder="Enter Genre">
                        </div>
                        <div class="form-group">
                            <label for="bookStock">Stock</label>
                            <input type="number" class="form-control" id="bookStock" placeholder="Enter stock quantity">
                        </div>
                        <!-- Add more fields as necessary -->
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" form="addBookForm">Add Book</button>
                </div>
            </div>
        </div>
    </div>

{% comment %} <div class="requestContainer">
    <h1>Requested Books to Issue</h1>
    <table class="requestTable">
        <tr>
            <th>User ID</th>
            <th>Book ID</th>
            <th>Allocate</th>
        </tr>
        <!-- Dynamically generated rows will go here -->
    </table>
</div>

<div class="issuedContainer">
    <h1>Issued Books</h1>
    <table class="issuedTable">
        <tr>
            <th>Book</th>
            <th>User</th>
            <th>Return By</th>
        </tr>
        <!-- Dynamically generated rows will go here -->
    </table>
</div>

<!-- The Modal -->
<div id="allocateModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <form id="allocateForm">
        <label for="returnDate">Return Date:</label>
        <input type="date" id="returnDate" name="returnDate">
        <input type="hidden" id="selectedBookId" name="bookId">
        <input type="hidden" id="selectedUserId" name="userId">
        <button type="submit">Allocate</button>
      </form>
    </div>
  </div> {% endcomment %}

</body>
<!-- Include jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Include Bootstrap JS (make sure to include Popper.js for Bootstrap v4 if needed) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Function to show the add book modal
    function showModal() {
        $('#addBookModal').modal('show'); // Using Bootstrap's modal function
    }
    
    // Function to hide the add book modal
    function hideModal() {
        $('#addBookModal').modal('hide'); // Using Bootstrap's modal function
    }
    
    // Fetch and display the catalog of books
    function fetchCatalog() {
        fetch('/list')
            .then(response => response.json())
            .then(data => {
                const books = data.books; // Adjusted to handle the response structure
                const tableBody = document.querySelector('.catalogTable tbody');
                tableBody.innerHTML = ''; // Clear existing rows
                books.forEach(book => {
                    const row = `<tr>
                                    <td>${book.id}</td>
                                    <td>${book.title}</td>
                                    <td>${book.author}</td>
                                    <td>${book.genre}</td> <!-- Added genre based on your JSON structure -->
                                    <td>${book.stock}</td>
                                    <td><button class="editLink" onclick="showModal()">Edit</button></td>
                                 </tr>`;
                    tableBody.innerHTML += row;
                });
            })
            .catch(error => console.error('Error fetching catalog:', error));
    }
    
    // Ensure the script runs after the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    var addBookForm = document.getElementById('addBookForm');
    if (addBookForm) {
        addBookForm.addEventListener('submit', function(event) {
            console.log('Adding book...');
            event.preventDefault();
            const bookData = {
                "title": document.getElementById('bookTitle').value,
                "author": document.getElementById('bookAuthor').value,
                "genre": document.getElementById('bookGenre').value,
                "stock": parseInt(document.getElementById('bookStock').value, 10)
            };
        
            fetch('/addbook', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bookData),
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                console.log('Success:', data);
                // Assuming hideModal() and fetchCatalog() are defined elsewhere
                hideModal();
                fetchCatalog(); // Refresh the catalog to include the new book
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    }
});
    
    // Initial fetch of the catalog
    document.addEventListener('DOMContentLoaded', function() {
        fetchCatalog();
    });
    </script>
</html>